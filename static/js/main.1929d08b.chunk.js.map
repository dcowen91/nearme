{"version":3,"sources":["App.tsx","index.tsx"],"names":["Map","ReactMapboxGl","accessToken","process","App","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","debouncedGetArticles","debounce","getArticles","state","latitude","longitude","showErrorDialog","selectedItemIndex","items","menuOpen","_this2","navigator","geolocation","getCurrentPosition","pos","setState","coords","_prevProps","prevState","_this3","react_default","a","createElement","className","href","target","rel","index_esm","renderIcon","renderOverlay","style","containerStyle","height","width","center","onMoveEnd","map","isNaN","transform","_center","lat","lng","lib_esm","type","id","layout","icon-image","icon-size","item","index","key","pageId","coordinates","onClick","getArticleDetail","_this4","currentState","renderMenuContent","itemSelected","Fragment","title","renderItemDetails","renderItemNames","description","split","subDescription","_this5","_this6","url","concat","axios","get","then","res","produce","draft","data","query","pages","extract","_this7","wikiItems","geosearch","responseItem","lon","pageid","React","Component","ReactDOM","render","src_App_0","document","getElementById"],"mappings":"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","file":"static/js/main.1929d08b.chunk.js","sourcesContent":["import React from \"react\";\r\nimport \"./App.css\";\r\nimport ReactMapboxGl, { Layer, Feature } from \"react-mapbox-gl\";\r\nimport axios from \"axios\";\r\nimport { debounce } from \"lodash-es\";\r\nimport { FaBars, FaTimes, FaGithub } from \"react-icons/fa\";\r\nimport produce from \"immer\";\r\n\r\ninterface IWikipediaResponse {\r\n  lat: number;\r\n  lon: number;\r\n  pageid: number;\r\n  title: number;\r\n}\r\n\r\ninterface IWikiItem {\r\n  latitude: number;\r\n  longitude: number;\r\n  pageId: number;\r\n  title: string;\r\n  description?: string;\r\n}\r\n\r\ninterface IAppState {\r\n  latitude: number;\r\n  longitude: number;\r\n  selectedItemIndex: number;\r\n  showErrorDialog: boolean;\r\n  items: IWikiItem[];\r\n  menuOpen: boolean;\r\n}\r\n\r\nconst Map = ReactMapboxGl({\r\n  accessToken: process.env.REACT_APP_MAPBOX_TOKEN as string\r\n});\r\n\r\nclass App extends React.Component<{}, IAppState> {\r\n  debouncedGetArticles = debounce(this.getArticles, 500);\r\n\r\n  constructor(props: {}) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      latitude: 47.6072062,\r\n      longitude: -122.3350407,\r\n      showErrorDialog: false,\r\n      selectedItemIndex: -1,\r\n      items: [],\r\n      menuOpen: false\r\n    };\r\n  }\r\n\r\n  componentDidMount(): void {\r\n    navigator.geolocation.getCurrentPosition(\r\n      (pos: Position) => {\r\n        this.setState({\r\n          latitude: pos.coords.latitude,\r\n          longitude: pos.coords.longitude\r\n        });\r\n\r\n        this.getArticles();\r\n      },\r\n      () => {\r\n        // TODO render error if location permission not granted\r\n        this.setState({ showErrorDialog: true });\r\n      }\r\n    );\r\n  }\r\n\r\n  componentDidUpdate(_prevProps: {}, prevState: IAppState): void {\r\n    if (\r\n      prevState.latitude !== this.state.latitude ||\r\n      prevState.longitude !== this.state.longitude\r\n    ) {\r\n      this.debouncedGetArticles();\r\n      // TODO add min change threshold/ make debounce logic smarter\r\n    }\r\n  }\r\n\r\n  render(): JSX.Element {\r\n    return (\r\n      <div className=\"App\">\r\n        <header className=\"App-header\">\r\n          <div className=\"innerHeader\">\r\n            {\"NEARME\"}\r\n            <a\r\n              className=\"gitLink\"\r\n              href=\"https://github.com/dcowen91/nearme\"\r\n              target=\"_blank\"\r\n              rel=\"noopener noreferrer\"\r\n            >\r\n              <FaGithub />\r\n            </a>\r\n          </div>\r\n        </header>\r\n        <div className=\"mapContainer\">\r\n          <div className=\"mapInner\">\r\n            {this.renderIcon()}\r\n            {this.renderOverlay()}\r\n            <Map\r\n              style=\"mapbox://styles/mapbox/dark-v10\"\r\n              containerStyle={{\r\n                height: \"100%\",\r\n                width: \"100%\"\r\n              }}\r\n              center={[this.state.longitude, this.state.latitude]}\r\n              onMoveEnd={map => {\r\n                // TODO there is clearly a bug here, find a better way to keep this in sync\r\n                if (!isNaN(map.transform._center.lat)) {\r\n                  this.setState({\r\n                    latitude: map.transform._center.lat,\r\n                    longitude: map.transform._center.lng\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n              <Layer\r\n                type=\"symbol\"\r\n                id=\"marker\"\r\n                layout={{\r\n                  \"icon-image\": \"marker-15\",\r\n                  \"icon-size\": 1.5\r\n                  // 'icon-color': '#F2e353'\r\n                }}\r\n              >\r\n                {this.state.items.map((item, index) => (\r\n                  <Feature\r\n                    key={item.pageId}\r\n                    coordinates={[item.longitude, item.latitude]}\r\n                    onClick={() =>\r\n                      this.setState(\r\n                        { selectedItemIndex: index, menuOpen: true },\r\n                        this.getArticleDetail\r\n                      )\r\n                    }\r\n                  />\r\n                ))}\r\n              </Layer>\r\n            </Map>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  renderIcon(): JSX.Element {\r\n    // TODO css animations\r\n    return (\r\n      <a\r\n        className=\"menu\"\r\n        onClick={() =>\r\n          this.setState(currentState => ({\r\n            menuOpen: !currentState.menuOpen,\r\n            selectedItemIndex: -1\r\n          }))\r\n        }\r\n      >\r\n        {this.state.menuOpen ? <FaTimes /> : <FaBars className=\"menuOpen\" />}\r\n      </a>\r\n    );\r\n  }\r\n\r\n  renderOverlay(): JSX.Element | undefined {\r\n    // TODO css animations\r\n    if (this.state.menuOpen) {\r\n      return <div className=\"sidebar\">{this.renderMenuContent()}</div>;\r\n    }\r\n  }\r\n\r\n  renderMenuContent(): JSX.Element {\r\n    const itemSelected = this.state.selectedItemIndex >= 0;\r\n    return (\r\n      <>\r\n        <h5>\r\n          {itemSelected\r\n            ? this.state.items[this.state.selectedItemIndex].title\r\n            : \"Locations\"}\r\n        </h5>\r\n        <div className=\"description\">\r\n          {itemSelected ? this.renderItemDetails() : this.renderItemNames()}\r\n        </div>\r\n      </>\r\n    );\r\n  }\r\n\r\n  renderItemDetails(): JSX.Element {\r\n    // TODO add margin\r\n    const { description } = this.state.items[this.state.selectedItemIndex];\r\n    if (description) {\r\n      return (\r\n        <>\r\n          {description.split(\"\\n\").map(subDescription => (\r\n            <p>{subDescription}</p>\r\n          ))}\r\n        </>\r\n      );\r\n    }\r\n\r\n    return <p>{\"No summary found\"}</p>;\r\n  }\r\n\r\n  renderItemNames(): JSX.Element {\r\n    return (\r\n      <ul>\r\n        {this.state.items.map((item, index) => (\r\n          <li\r\n            key={item.pageId}\r\n            className=\"listItem\"\r\n            onClick={() =>\r\n              this.setState({ selectedItemIndex: index }, this.getArticleDetail)\r\n            }\r\n          >\r\n            {item.title}\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    );\r\n  }\r\n\r\n  private getArticleDetail(): void {\r\n    if (this.state.selectedItemIndex >= 0) {\r\n      const item = this.state.items[this.state.selectedItemIndex];\r\n      if (!item.description) {\r\n        const pageId = item.pageId;\r\n        const url = `https://en.wikipedia.org/w/api.php?format=json&origin=*&action=query&prop=extracts&exintro&explaintext&redirects=1&pageids=${pageId}`;\r\n        axios.get(url).then(res => {\r\n          this.setState(\r\n            produce((draft: IAppState) => {\r\n              draft.items[draft.selectedItemIndex].description =\r\n                res.data.query.pages[pageId].extract;\r\n            })\r\n          );\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  getArticles(): void {\r\n    const url = `https://en.wikipedia.org/w/api.php?action=query&list=geosearch&gsradius=10000&gscoord=${\r\n      this.state.latitude\r\n    }|${this.state.longitude}&format=json&origin=*`;\r\n\r\n    axios.get(url).then(res => {\r\n      const wikiItems: IWikiItem[] = res.data.query.geosearch.map(\r\n        (responseItem: IWikipediaResponse) => {\r\n          return {\r\n            latitude: responseItem.lat,\r\n            longitude: responseItem.lon,\r\n            pageId: responseItem.pageid,\r\n            title: responseItem.title\r\n          };\r\n        }\r\n      );\r\n\r\n      this.setState({ items: wikiItems });\r\n    });\r\n  }\r\n}\r\n\r\nexport default App;\r\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}
{"version":3,"sources":["App.tsx","index.tsx"],"names":["Map","ReactMapboxGl","accessToken","process","App","props","_this","Object","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","debouncedGetArticles","debounce","getArticles","state","latitude","longitude","showErrorDialog","selectedItemIndex","items","menuOpen","_this2","navigator","geolocation","getCurrentPosition","pos","setState","coords","_prevProps","prevState","_this3","react_default","a","createElement","className","renderIcon","renderOverlay","style","containerStyle","height","width","center","onMoveEnd","map","console","log","isNaN","transform","_center","lat","lng","lib_esm","type","id","layout","icon-image","icon-size","item","index","key","pageId","coordinates","onClick","getArticleDetail","_this4","currentState","index_esm","renderMenuContent","itemSelected","Fragment","title","renderItemDetails","renderItemNames","description","split","subDescription","_this5","_this6","url","concat","axios","get","then","res","produce","draft","data","query","pages","extract","_this7","wikiItems","geosearch","responseItem","lon","pageid","React","Component","ReactDOM","render","src_App_0","document","getElementById"],"mappings":"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","file":"static/js/main.a860020e.chunk.js","sourcesContent":["import React from 'react';\r\nimport './App.css';\r\nimport ReactMapboxGl, { Layer, Feature } from 'react-mapbox-gl';\r\nimport axios from 'axios';\r\nimport { debounce } from 'lodash-es';\r\nimport { FaBars, FaTimes } from 'react-icons/fa';\r\nimport produce from 'immer';\r\n\r\ninterface IWikipediaResponse {\r\n\tlat: number;\r\n\tlon: number;\r\n\tpageid: number;\r\n\ttitle: number;\r\n}\r\n\r\ninterface IWikiItem {\r\n\tlatitude: number;\r\n\tlongitude: number;\r\n\tpageId: number;\r\n\ttitle: string;\r\n\tdescription?: string;\r\n}\r\n\r\ninterface IAppState {\r\n\tlatitude: number;\r\n\tlongitude: number;\r\n\tselectedItemIndex: number;\r\n\tshowErrorDialog: boolean;\r\n\titems: IWikiItem[];\r\n\tmenuOpen: boolean;\r\n}\r\n\r\nconst Map = ReactMapboxGl({\r\n\taccessToken: process.env.REACT_APP_MAPBOX_TOKEN as string\r\n});\r\n\r\nclass App extends React.Component<{}, IAppState> {\r\n\tdebouncedGetArticles = debounce(this.getArticles, 500);\r\n\r\n\tconstructor(props: {}) {\r\n\t\tsuper(props);\r\n\r\n\t\tthis.state = {\r\n\t\t\tlatitude: 47.6072062,\r\n\t\t\tlongitude: -122.3350407,\r\n\t\t\tshowErrorDialog: false,\r\n\t\t\tselectedItemIndex: -1,\r\n\t\t\titems: [],\r\n\t\t\tmenuOpen: false\r\n\t\t};\r\n\t}\r\n\r\n\tcomponentDidMount(): void {\r\n\t\tnavigator.geolocation.getCurrentPosition(\r\n\t\t\t(pos: Position) => {\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tlatitude: pos.coords.latitude,\r\n\t\t\t\t\tlongitude: pos.coords.longitude\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.getArticles();\r\n\t\t\t},\r\n\t\t\t() => {\r\n\t\t\t\t// TODO render error if location permission not granted\r\n\t\t\t\tthis.setState({ showErrorDialog: true });\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate(_prevProps: {}, prevState: IAppState): void {\r\n\t\tif (prevState.latitude !== this.state.latitude || prevState.longitude !== this.state.longitude) {\r\n\t\t\tthis.debouncedGetArticles();\r\n\t\t\t// TODO add min change threshold/ make debounce logic smarter\r\n\t\t}\r\n\t}\r\n\r\n\trender(): JSX.Element {\r\n\t\treturn (\r\n\t\t\t<div className=\"App\">\r\n\t\t\t\t<header className=\"App-header\">{'NEARME'}</header>\r\n\t\t\t\t<div className=\"mapContainer\">\r\n\t\t\t\t\t<div className=\"mapInner\">\r\n\t\t\t\t\t\t{this.renderIcon()}\r\n\t\t\t\t\t\t{this.renderOverlay()}\r\n\t\t\t\t\t\t<Map\r\n\t\t\t\t\t\t\tstyle=\"mapbox://styles/mapbox/dark-v10\"\r\n\t\t\t\t\t\t\tcontainerStyle={{\r\n\t\t\t\t\t\t\t\theight: '100%',\r\n\t\t\t\t\t\t\t\twidth: '100%'\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tcenter={[this.state.longitude, this.state.latitude]}\r\n\t\t\t\t\t\t\tonMoveEnd={map => {\r\n\t\t\t\t\t\t\t\tconsole.log('MOVED');\r\n\t\t\t\t\t\t\t\t// TODO there is clearly a bug here, find a better way to keep this in sync\r\n\t\t\t\t\t\t\t\tif (!isNaN(map.transform._center.lat)) {\r\n\t\t\t\t\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\t\t\t\t\tlatitude: map.transform._center.lat,\r\n\t\t\t\t\t\t\t\t\t\tlongitude: map.transform._center.lng\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<Layer\r\n\t\t\t\t\t\t\t\ttype=\"symbol\"\r\n\t\t\t\t\t\t\t\tid=\"marker\"\r\n\t\t\t\t\t\t\t\tlayout={{\r\n\t\t\t\t\t\t\t\t\t'icon-image': 'marker-15',\r\n\t\t\t\t\t\t\t\t\t'icon-size': 1.5\r\n\t\t\t\t\t\t\t\t\t// 'icon-color': '#F2e353'\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{this.state.items.map((item, index) => (\r\n\t\t\t\t\t\t\t\t\t<Feature\r\n\t\t\t\t\t\t\t\t\t\tkey={item.pageId}\r\n\t\t\t\t\t\t\t\t\t\tcoordinates={[item.longitude, item.latitude]}\r\n\t\t\t\t\t\t\t\t\t\tonClick={() => this.setState({ selectedItemIndex: index, menuOpen: true }, this.getArticleDetail)}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t))}\r\n\t\t\t\t\t\t\t</Layer>\r\n\t\t\t\t\t\t</Map>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n\r\n\trenderIcon(): JSX.Element {\r\n\t\t// TODO css animations\r\n\t\treturn (\r\n\t\t\t<a\r\n\t\t\t\tclassName=\"menu\"\r\n\t\t\t\tonClick={() => this.setState(currentState => ({ menuOpen: !currentState.menuOpen, selectedItemIndex: -1 }))}\r\n\t\t\t>\r\n\t\t\t\t{this.state.menuOpen ? <FaTimes /> : <FaBars className=\"menuOpen\" />}\r\n\t\t\t</a>\r\n\t\t);\r\n\t}\r\n\r\n\trenderOverlay(): JSX.Element | undefined {\r\n\t\t// TODO css animations\r\n\t\tif (this.state.menuOpen) {\r\n\t\t\treturn <div className=\"sidebar\">{this.renderMenuContent()}</div>;\r\n\t\t}\r\n\t}\r\n\r\n\trenderMenuContent(): JSX.Element {\r\n\t\tconst itemSelected = this.state.selectedItemIndex >= 0;\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<h5>{itemSelected ? this.state.items[this.state.selectedItemIndex].title : 'Locations'}</h5>\r\n\t\t\t\t<div className=\"description\">{itemSelected ? this.renderItemDetails() : this.renderItemNames()}</div>\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\r\n\trenderItemDetails(): JSX.Element {\r\n\t\t// TODO add margin\r\n\t\tconst { description } = this.state.items[this.state.selectedItemIndex];\r\n\t\tif (description) {\r\n\t\t\treturn (\r\n\t\t\t\t<>\r\n\t\t\t\t\t{description.split('\\n').map(subDescription => (\r\n\t\t\t\t\t\t<p>{subDescription}</p>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</>\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn <p>{'No summary found'}</p>;\r\n\t}\r\n\r\n\trenderItemNames(): JSX.Element {\r\n\t\treturn (\r\n\t\t\t<ul>\r\n\t\t\t\t{this.state.items.map((item, index) => (\r\n\t\t\t\t\t<li\r\n\t\t\t\t\t\tkey={item.pageId}\r\n\t\t\t\t\t\tclassName=\"listItem\"\r\n\t\t\t\t\t\tonClick={() => this.setState({ selectedItemIndex: index }, this.getArticleDetail)}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{item.title}\r\n\t\t\t\t\t</li>\r\n\t\t\t\t))}\r\n\t\t\t</ul>\r\n\t\t);\r\n\t}\r\n\r\n\tprivate getArticleDetail(): void {\r\n\t\tif (this.state.selectedItemIndex >= 0) {\r\n\t\t\tconst item = this.state.items[this.state.selectedItemIndex];\r\n\t\t\tif (!item.description) {\r\n\t\t\t\tconst pageId = item.pageId;\r\n\t\t\t\tconst url = `https://en.wikipedia.org/w/api.php?format=json&origin=*&action=query&prop=extracts&exintro&explaintext&redirects=1&pageids=${pageId}`;\r\n\t\t\t\taxios.get(url).then(res => {\r\n\t\t\t\t\tthis.setState(\r\n\t\t\t\t\t\tproduce((draft: IAppState) => {\r\n\t\t\t\t\t\t\tdraft.items[draft.selectedItemIndex].description = res.data.query.pages[pageId].extract;\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetArticles(): void {\r\n\t\tconst url = `https://en.wikipedia.org/w/api.php?action=query&list=geosearch&gsradius=10000&gscoord=${\r\n\t\t\tthis.state.latitude\r\n\t\t}|${this.state.longitude}&format=json&origin=*`;\r\n\r\n\t\taxios.get(url).then(res => {\r\n\t\t\tconst wikiItems: IWikiItem[] = res.data.query.geosearch.map((responseItem: IWikipediaResponse) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tlatitude: responseItem.lat,\r\n\t\t\t\t\tlongitude: responseItem.lon,\r\n\t\t\t\t\tpageId: responseItem.pageid,\r\n\t\t\t\t\ttitle: responseItem.title\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\tthis.setState({ items: wikiItems });\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport default App;\r\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}